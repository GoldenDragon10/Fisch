<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CS:GO Crate Opening Animation</title>
  <style>
    body {
      margin: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      background-color: #1e1e2f;
      color: white;
      overflow: hidden;
    }

    /* Crate Box for Animation */
    .crate-box {
      width: 700px;
      height: 150px;
      background-color: #333;
      border-radius: 10px;
      display: none; /* Initially hidden */
      position: relative;
      overflow: hidden;
      box-shadow: 0 0 15px rgba(0, 0, 0, 0.5);
    }

    /* Scrolling Items */
    .item-container {
      display: flex;
      position: absolute;
      top: 0;
      left: 0;
      height: 100%;
      animation: none;
    }

    .item {
      width: 150px;
      height: 100%;
      margin: 0 5px;
      background-color: #222;
      display: flex;
      justify-content: center;
      align-items: center;
      border-radius: 5px;
      overflow: hidden;
      box-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
    }

    .item img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    /* Item reveal animation */
    .selected-item {
      font-size: 2rem;
      color: #fff;
      margin-top: 20px;
      opacity: 0;
      animation: revealItem 2s ease-in-out forwards;
    }

    @keyframes revealItem {
      0% { opacity: 0; }
      100% { opacity: 1; }
    }
  </style>
</head>
<body>
  <!-- Crate Box -->
  <div id="crateBox" class="crate-box">
    <div id="itemContainer" class="item-container">
      <!-- Dynamically populated items will go here -->
    </div>
  </div>

  <!-- Revealed Item -->
  <div id="selectedItem" class="selected-item">You Got: </div>

  <script>
    // List of items (modify with your own image paths and item names)
    const items = [
      { name: "AK-47 | Redline", image: "ak47.png" },
      { name: "M4A4 | Howl", image: "m4a4.png" },
      { name: "AWP | Dragon Lore", image: "awp.png" },
      { name: "USP-S | Orion", image: "usp.png" },
      { name: "Glock-18 | Water Elemental", image: "glock.png" }
    ];

    const container = document.getElementById("itemContainer");
    const crateBox = document.getElementById("crateBox");
    const selectedItem = document.getElementById("selectedItem");

    // Function to dynamically populate the item container with duplicates
    function populateItems() {
      const originalItems = [...items]; // Make a copy of the original items
      const duplicateCount = 3; // Number of times to duplicate items

      // Add duplicates to the items array
      for (let i = 0; i < duplicateCount; i++) {
        items.push(...originalItems); // Add duplicates of the original items
      }

      // Populate the item container dynamically
      container.innerHTML = ""; // Clear any existing items
      items.forEach(item => {
        const itemDiv = document.createElement("div");
        itemDiv.classList.add("item");
        itemDiv.innerHTML = `<img src="${item.image}" alt="${item.name}">`;
        container.appendChild(itemDiv);
      });
    }

    // Function to simulate the crate opening and reveal an item
    function openCrate() {
      crateBox.style.display = "block"; // Show the crate box

      // Calculate total width for scrolling
      const itemWidth = 160; // Width + margin of each item
      const totalItems = items.length; // Updated with duplicates
      const selectedIndex = Math.floor(Math.random() * (totalItems / 3)); // Select from original set
      const stopPosition = -(selectedIndex * itemWidth) + 275; // Center selected item in the box

      // Animate the container
      container.style.transition = "transform 3s cubic-bezier(0.25, 0.8, 0.25, 1)";
      container.style.transform = `translateX(${stopPosition}px)`; // Scroll to selected item

      // Reveal the selected item after the animation ends
      setTimeout(() => {
        selectedItem.textContent = `You Got: ${items[selectedIndex].name}`;
        selectedItem.style.opacity = 1;
      }, 3000); // Match animation duration
    }

    // Function to handle follow events and trigger the animation
    function showFollowAnimation(followerName) {
      selectedItem.textContent = `Thank you for following, ${followerName}!`; // Display follower name
      selectedItem.style.opacity = 1;

      populateItems(); // Populate the item container dynamically
      setTimeout(() => {
        openCrate(); // Trigger crate opening animation
      }, 1000); // Delay before opening the crate
    }

    // Listen for the message event (webhook data)
    window.addEventListener("message", function (event) {
      // Parse the URL-encoded data from the webhook
      const params = new URLSearchParams(event.data);

      // Extract relevant fields from the payload
      const followerName = params.get('username') || params.get('nickname') || "A New Follower"; // Use username or nickname
      const triggerTypeId = params.get('triggerTypeId'); // Identify the type of event

      // Check if the event is a follow (triggerTypeId = 9 is likely for follows in TikFinity)
      if (triggerTypeId === "9") {
        showFollowAnimation(followerName); // Trigger the animation for the follower
      } else {
        console.log("Event is not a follow, ignoring...");
      }
    });

    // For testing, simulate a follow event:
    // window.postMessage("value1=Testuser&value2=&content=Fisch&userId=1&username=Testuser&nickname=Test+User&commandParams=&triggerTypeId=9&tikfinityUserId=1064421&tikfinityUsername=thegoldendragon", "*");
  </script>
</body>
</html>
